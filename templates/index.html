<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pronóstico PM2.5 - GRU</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
      body { padding-top: 24px; }
      #chart { max-width: 100%; }
      .table-wrapper { max-height: 360px; overflow: auto; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 class="mb-3">Pronóstico de PM2.5</h1>
      <p class="text-muted">Modelo GRU con predicción de próximas horas.</p>

      <div class="card mb-4">
        <div class="card-body">
          <form id="predictForm" class="row g-3">
            <div class="col-sm-6 col-md-4">
              <label for="hoursInput" class="form-label">Horas a predecir (1-24)</label>
              <input type="number" id="hoursInput" class="form-control" min="1" max="24" value="6" required />
            </div>
            <div class="col-sm-6 col-md-4 d-flex align-items-end">
              <button type="submit" class="btn btn-primary">Predecir</button>
            </div>
          </form>

          <div id="errorBox" class="alert alert-danger mt-3 d-none"></div>
        </div>
      </div>

      <div class="row">
        <div class="col-lg-7">
          <div class="card mb-3">
            <div class="card-header">Gráfico de Predicción</div>
            <div class="card-body text-center">
              <img id="chartImg" alt="Gráfico de predicción" class="img-fluid" />
            </div>
          </div>
        </div>
        <div class="col-lg-5">
          <div class="card mb-3">
            <div class="card-header d-flex justify-content-between align-items-center">
              <span>Tabla de Resultados</span>
              <button id="downloadBtn" class="btn btn-outline-secondary btn-sm" disabled>Descargar CSV</button>
            </div>
            <div class="card-body table-wrapper">
              <table class="table table-striped" id="resultsTable">
                <thead>
                  <tr>
                    <th>Hora (+h)</th>
                    <th>PM2.5</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="card mb-4">
        <div class="card-header">Explicación GRU/Minions</div>
        <div class="card-body" id="gruExplainer">
          <p class="mb-2">
            Imagina a <strong>Gru</strong> coordinando a los minions: nuestra
            <strong>GRU</strong> (Gated Recurrent Unit) "recuerda" las últimas horas
            y planifica las siguientes para anticipar la concentración de PM2.5.
          </p>
          <p class="text-muted mb-0">
            Tras realizar una predicción, aquí verás una explicación sencilla con
            flechas de tendencia (↗️/↘️/→), el promedio estimado y recomendaciones
            rápidas según el umbral de 15 µg/m³.
          </p>
        </div>
      </div>

      <div class="card mb-4">
        <div class="card-header">Briefing de Misión</div>
        <div class="card-body" id="missionBrief">
          <p class="mb-2">
            Antes de salir, el equipo necesita saber la <strong>calidad del aire</strong>
            de las próximas horas para decidir <strong>qué nave y equipo</strong> llevar.
          </p>
          <ul class="mb-2 text-muted">
            <li>Predice las próximas horas para ver la recomendación.</li>
            <li>La elección es conservadora (se toma el pico previsto).</li>
          </ul>
          <div id="missionRecommendation" class="alert alert-info mb-0">
            Aún no hay predicción. Realiza una para obtener el plan de misión.
          </div>
        </div>
      </div>

      <footer class="mt-4 mb-3 text-center text-muted">
        <small>Tiempo de respuesta esperado &lt; 2s</small>
      </footer>
    </div>

    <script src="/static/app.js"></script>
  </body>
  </html>